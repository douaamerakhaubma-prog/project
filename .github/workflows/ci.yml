name: Pipeline CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  tests:
    runs-on: ubuntu-latest

    steps:
      - name: Télécharger le code
        uses: actions/checkout@v4

      - name: Installer Java 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Afficher les infos
        run: |
          echo "=== INFORMATIONS ==="
          echo "Utilisateur : ${{ github.actor }}"
          echo "Branche : ${{ github.ref }}"
          java --version
          mvn --version

      - name: Compiler
        run: mvn clean compile

      - name: Tests unitaires
        run: mvn test

      - name: Afficher résultats
        if: always()
        run: |
          echo "=== RÉSULTATS ==="
          if [ -f target/surefire-reports/com.exemple.CalculatorTest.txt ]; then
            echo "Rapport de tests :"
            cat target/surefire-reports/com.exemple.CalculatorTest.txt
          else
            echo "Aucun rapport trouvé"
          fi

      - name: Notifier échec
        if: failure()
        run: |
          echo "TESTS ÉCHOUÉS"
          echo "Veuillez corriger les erreurs"
